---
title: "ProxySetter"
date: 2020-02-01T17:58:23+08:00
draft: false
weight: 40
---

这个插件有两个相互独立的功能，一个是在Tuna启用tun模式，另一个是修改windows系统“Internet选项”里的代理设定的。  
这两个功能使用其中一个就好，同时使用会互相干扰。  

#### Tuna
Tuna通过tun2socks开启tun模式。第一次进入这个界面的时候会自动填充各项参数。如果填的参数不合适，你可以修改后再点下"生成参数"。tun2socks需要admin权限运行，所以每次点启动时都会弹出UAC确认窗口。如果以管理员权限启动V2RayGCon可以避免弹UAC窗口。但是非常不建议这么做，因为很不安全。tun会转发udp和tcp两种协议的数据，所以服务器的inbound最好是socks协议并开启udp支持。如果DNS留空那么DNS请求将从原来的网卡发出，俗称DNS泄露。如果不钩IPv6而你的网络又支持IPv6，那么访问IPv6网站时就是在裸奔。但是IPv6需要本地和远程服务器同时支持才会有完整体验。开启tun之后PAC分流失效，需要配置v2ray-core的routing来分流。可以在选项窗口编写routing模板然后钩选。重启服务器时模板会注入到配置里面。  

tun的原理是新建一张虚拟网卡，然后网络流量优先从这张网卡发送。但是有些不讲武德的软件可以无视这个优先级，直接从物理网卡发送数据。v2ray就是其中之一。所以开启tun模式并等于所有流量都走代理。  

tun对复杂的网络不太友好，比如需要同时访问专用网、内网、外网。这种场景建议使用按进程代理的软件：  
[https://github.com/PragmaTwice/proxinject](https://github.com/PragmaTwice/proxinject)  

#### PAC及系统代理
{{< figure src="../../images/plugins/plugin_proxysetter.png" >}}
最右侧的“在记事本中...”和“在浏览器中...”对调试问题会有点帮助。  

通常选下“PAC”或者“全局”，然后钩上后面的自动（默认已钩）就不用管其他选项了。“自动”的意思是当你切换不同服务器时，代理设定会跟着更新（日志窗口有相应提示）。不过“自动”不是万能的，假如你选了全局模式，但只开启一个SOCKS服务器，那么就没法设定代理。因为windows的全局代理必需是HTTP代理。  

基于以下几点原因，本项目不使用GFWList作为默认PAC源：
 1. “正版”GFWList已经很久没更新，很多网站已经不适用
 2. 其他人维护的GFWList多如牛毛，选哪个都会有人跳出来说不好
 3. GFWList使用正则来匹配域名的算法，已在其他（非v2ray相关）项目中显示出弊端

不过。。。这个插件有个“自定义PAC”功能，想用什么就用什么吧。  
使用自定义PAC的时候，注意主窗口中服务器的模式和端口要和你所使用的PAC相匹配。浏览器调试功能以及“设置”分页中的白黑名单设置对自定义PAC无效。  
 